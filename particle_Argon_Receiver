// Array to store the previous values
int prevValues[5] = {0, 0, 0, 0, 0};

// Responses for each sensor
String responses[5] = {
    "Sensor 1 Response",
    "Sensor 2 Response",
    "Sensor 3 Response",
    "Sensor 4 Response",
    "Sensor 5 Response"
};

// Array to store the current sensor values received
int currentValues[5] = {0};

void setup() {
    // Initialize the serial monitor
    Serial.begin(9600);

    // Subscribe to the published data
    Particle.subscribe("flexSensorData", handleSensorData, MY_DEVICES);
}

void loop() {
    // Loop through each sensor
    for (int i = 0; i < 5; i++) {
        // Check if the difference exceeds 100
        if (abs(currentValues[i] - prevValues[i]) > 200) {
            // Print the corresponding response
            Serial.println(responses[i]);
        }

        // Update the previous value
        prevValues[i] = currentValues[i];
    }

    // Delay to avoid spamming the serial monitor
    delay(500);
}

// Function to handle and process received sensor data
void handleSensorData(const char *event, const char *data) {
    // Print the received data for debugging
    //Serial.println("Received data: " + String(data));

    // Parse the received string and convert it to integer values
    sscanf(data, "%d,%d,%d,%d,%d", &currentValues[0], &currentValues[1], &currentValues[2], &currentValues[3], &currentValues[4]);
}
